{% extends 'base.html.twig' %}

{% block title %}
	{{ entity.brand }} - Details
{% endblock %}

{% block content %}
	<div class="container">

		{% include 'partials/breadcrumb.html.twig' with { current: entity.brand } %}

		<div class="detail-grid">
  			<!-- Entity information -->
  			<div class="info-column">
    			{% include 'partials/entity_info.html.twig' %}
  			</div>

			<!-- Chart -->
			<div class="column">
				<div class="card-body">
					{% include 'partials/chart.html.twig' with {
						title: 'Entity Measurements',
						chart_id: 'resultsChart',
						labels: entity.chart_data.labels,
						datasets: [{ 
							label: 'Usage Capacity (ml)',
							data: entity.chart_data.values,
							backgroundColor: entity.results|map(result => saturation_color(result.saturation)),
							borderColor: entity.results|map(result => saturation_color(result.saturation)),
							borderWidth: 2,
							type: 'bar',
							fill: true,
							tension: 0.1
						}],
						gradient: true
					} %}
				</div>
			</div>

			<!-- Test results table -->
			<div class="full-column">
				<div class="card">
					<div class="card-header">
						<h5>Detailed Test Results</h5>
					</div>
					<div class="card-body">
						<div class="table-wrapper">
							<table class="entity-table">
								<thead>
									<tr>
										<th>Measurement</th>
										<th>Usage Value (ml)</th>
										<th>Saturation</th>
										<th>Comment</th>
										<th>&nbsp;</th>
									</tr>
								</thead>
								<tbody>
									<tr>
										<input type="hidden" id="entity_id" value="{{ entity.id }}">
										<td><input type="text" id="measurement_number" class="text-input" placeholder="Would be datetime here" disabled></td>
										<td><input type="text" id="result_value" class="text-input" placeholder="Result Value"></td>
										<td><input type="text" id="saturation" class="text-input" placeholder="Saturation"></td>
										<td><input type="text" id="note" class="text-input full-width" placeholder="Note"></td>
										<td>
											<button id="add_result" class="button primary full-width">Add</button>
										</td>
									</tr>
									{% for result in entity.results %}
										<tr>
											<td>Measurement {{ result.measurement_number }}</td>
											<td>{{ result.result_value }} ml</td>
											<td>{{ result.saturation }}</td>
											<td>{{ result.note }}</td>
											<td>
												<button class="button danger full-width">Delete</button>
											</td>
										</tr>
									{% endfor %}
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="form-footer">
			<a href="/" class="button secondary">Back to Entity List</a>
			<a href="/compare?ids={{ entity.id }}" class="button primary">Compare With Others</a>
		</div>
	</div>
{% endblock %}
